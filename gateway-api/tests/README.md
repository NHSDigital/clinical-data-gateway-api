# Gateway API Tests

This directory contains the test suite for the gateway API.

## Test Structure

- `test_main.py` - Unit tests for the Flask application endpoints (fast, using test client)
- `test_consumer_contract.py` - Consumer contract tests using Pact (defines API expectations)
- `test_provider_contract.py` - Provider integration tests using Pact (spins up real Flask app to verify contracts)

## Running Tests

### Install Dependencies

```bash
cd gateway-api
poetry install --extras dev
```

### Run All Tests

```bash
poetry run pytest
```

### Run Specific Test Types

```bash
# Run only unit tests
poetry run pytest tests/test_main.py

# Run only consumer contract tests
poetry run pytest tests/test_consumer_contract.py

# Run only provider contract tests
poetry run pytest tests/test_provider_contract.py
```

### Run with Verbose Output

```bash
poetry run pytest -v
```

### Run with Coverage

```bash
poetry run pytest --cov=gateway_api --cov-report=html
```

## Test Types

### Unit Tests (`test_main.py`)
Fast tests using Flask's test client without spinning up a server. Run these frequently during development.

### Contract Testing with Pact

The test suite includes contract tests using Pact-Python:

1. **Consumer Tests** (`test_consumer_contract.py`):
   - Define the expected interactions with the API
   - Use a mock provider (fast, no real server)
   - Generate pact files in `tests/pacts/` directory
   - Run these first to create the contract

2. **Provider Integration Tests** (`test_provider_contract.py`):
   - Spin up the actual Flask application on port 5001
   - Verify that the real API implementation satisfies the contracts
   - Use the pact files generated by consumer tests
   - Slower than unit tests - consider running in CI/CD rather than locally for every change
   - Run these after consumer tests

### Contract Testing Workflow

```bash
# Step 1: Run consumer tests to generate contracts
poetry run pytest tests/test_consumer_contract.py

# Step 2: Verify provider honors the contracts
poetry run pytest tests/test_provider_contract.py
```

## Pact Files

Consumer tests generate pact files in `tests/pacts/`. These files represent the contract between the consumer and provider and should be committed to version control.
